
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Analysis Framework &#8212; FUNtoFEM .0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FUNtoFEM Model" href="model.html" />
    <link rel="prev" title="Welcome to FUNtoFEM’s Documentation" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="model.html" title="FUNtoFEM Model"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to FUNtoFEM’s Documentation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">FUNtoFEM .0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis Framework</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="analysis-framework">
<h1>Analysis Framework<a class="headerlink" href="#analysis-framework" title="Permalink to this heading">¶</a></h1>
<p>Terms are color coded in this framework to keep track of the several aspects of the code:</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(\color{green} \text{Transfer Scheme}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\color{blue} \text{Fluid Solver}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\color{orange} \text{Structural Solver}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\color{red} \text{Shape Parameterization}\)</span></p></li>
</ol>
<section id="meld-transfer-scheme">
<h2>MELD Transfer Scheme<a class="headerlink" href="#meld-transfer-scheme" title="Permalink to this heading">¶</a></h2>
<p>The following residuals are computed in the forward direction for the MELD
transfer scheme, which transfers displacements, loads, and heat flux.</p>
<section id="displacement-transfer-residual">
<h3>Displacement Transfer Residual<a class="headerlink" href="#displacement-transfer-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{green}D}(\mathbf{u}_A, \mathbf{u}_S, \mathbf{x}_A, \mathbf{x}_S) \triangleq
\mathbf{u}_A - \xi(\mathbf{u}_S, \mathbf{x}_A, \mathbf{x}_S) = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{u}_A\)</span> - displacements of aerodynamic surface nodes</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{u}_S\)</span> - displacements of structural nodes</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector (made up of <span class="math notranslate nohighlight">\(\mathbf{x}_A\)</span> and <span class="math notranslate nohighlight">\(\mathbf{x}_S\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\xi\)</span> - action of the displacement transfer</p></li>
</ul>
</section>
<section id="load-transfer-residual">
<h3>Load Transfer Residual<a class="headerlink" href="#load-transfer-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{green}L}(\mathbf{f}_A, \mathbf{f}_S, \mathbf{u}_S, \mathbf{x}_A, \mathbf{x}_S)
\triangleq \mathbf{f}_S - \eta (\mathbf{f}_A, \mathbf{u}_S, \mathbf{x}_A, \mathbf{x}_S) = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{f}_A\)</span> - nodal forces on aerodynamic surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{f}_S\)</span> - nodal forces on structure</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{u}_S\)</span> - discplaments of structural nodes</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector (made up of <span class="math notranslate nohighlight">\(\mathbf{x}_A\)</span> and <span class="math notranslate nohighlight">\(\mathbf{x}_S\)</span>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\xi\)</span> - action of the displacement transfer</p></li>
</ul>
</section>
<section id="heat-flux-transfer-residual">
<h3>Heat Flux Transfer Residual<a class="headerlink" href="#heat-flux-transfer-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{green}Q}(\mathbf{h}_A, \mathbf{h}_S) \triangleq \mathbf{h}_S - \mathbf{W}^T \mathbf{h}_A = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{h}_A\)</span> - aerodynamic heat flux at the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{h}_S\)</span> - structure heat flux at the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{W}\)</span> - weight matrix for the temperature transfer</p></li>
</ul>
</section>
<section id="temperature-residual">
<h3>Temperature Residual<a class="headerlink" href="#temperature-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{green}T}(\mathbf{t}_A, \mathbf{t}_S) \triangleq \mathbf{t}_A - \mathbf{W}\mathbf{t}_S = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{t}_A\)</span> - aerodynamic temperatures at the structure surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{t}_S\)</span> - structure temperatures at the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{W}\)</span> - weight matrix for the temperature transfer</p></li>
</ul>
</section>
</section>
<section id="fun3d-flow-solver">
<h2>FUN3D, Flow Solver<a class="headerlink" href="#fun3d-flow-solver" title="Permalink to this heading">¶</a></h2>
<section id="flow-residual">
<h3>Flow Residual<a class="headerlink" href="#flow-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{blue}A}(\mathbf{q}, t, \mathbf{t}_A, \mathbf{x}, \mathbf{x}_G) \triangleq
\frac{\partial (\mathbf{q}V)}{\partial t} + \oint\left(\mathbf{\overline{\overline{F}}}^* -
\mathbf{\overline{\overline{F}}}_v  \right) \cdot \mathbf{\hat{n}} \text{dS} = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{q}\)</span> - flow state vector</p></li>
<li><p><span class="math notranslate nohighlight">\(t\)</span> - time</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{t}_A\)</span> - aerodynamic surface mesh temperature</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}_G\)</span> - aerodynamic volume mesh</p></li>
</ul>
</section>
<section id="force-integration-residual">
<h3>Force Integration Residual<a class="headerlink" href="#force-integration-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{blue}F}(\mathbf{f}_A, \mathbf{q}, \mathbf{x}_G) \triangleq
\mathbf{f}_A - \phi(\mathbf{q}, \mathbf{x}_G) = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{f}_A\)</span> - nodal forces on aerodynamic surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}_G\)</span> - aerodynamic volume mesh</p></li>
<li><p><span class="math notranslate nohighlight">\(\phi\)</span> - action of the force integration</p></li>
</ul>
</section>
<section id="grid-deformation-residual">
<h3>Grid Deformation Residual<a class="headerlink" href="#grid-deformation-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{blue}G}(\mathbf{u}_A, \mathbf{x}, \mathbf{x}_G) \triangleq
( \mathbf{x}_{A0}+\mathbf{u}_A ) - \mathbf{K}_G \mathbf{x}_G = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{u}_A\)</span> - displacements of aerodynamic surface nodes</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}_{A0}\)</span> - initial aerodynamic surface mesh (after shape changes)</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}_G\)</span> - aerodynamic volume mesh</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{K}_G\)</span> - mesh elasticity stiffness matrix based on <span class="math notranslate nohighlight">\(\mathbf{ \hat{x} }_G\)</span> (constant)</p></li>
</ul>
</section>
<section id="heat-flux-integration-residual">
<h3>Heat Flux Integration Residual<a class="headerlink" href="#heat-flux-integration-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{blue}H}(\mathbf{h}_A, \mathbf{q}, \mathbf{t}_A, \mathbf{x}, \mathbf{x}_G) \triangleq
\mathbf{h}_A(\mathbf{t}_A) - \varphi (\mathbf{q}, \mathbf{x}, \mathbf{x}_G) = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{h}_A\)</span> - aerodynamic heat flux at the surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{q}\)</span> - flow state vector</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{t}_A\)</span> - aerodynamic temperatures at the structure surface</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}_G\)</span> - aerodynamic volume mesh</p></li>
<li><p><span class="math notranslate nohighlight">\(\varphi\)</span> - action of the heat flux integration</p></li>
</ul>
</section>
</section>
<section id="tacs-structure-solver">
<h2>TACS, Structure Solver<a class="headerlink" href="#tacs-structure-solver" title="Permalink to this heading">¶</a></h2>
<section id="structural-residual">
<h3>Structural Residual<a class="headerlink" href="#structural-residual" title="Permalink to this heading">¶</a></h3>
<div class="math notranslate nohighlight">
\[\mathbf{\color{orange}S}(\mathbf{f}_S, \mathbf{u}_S, \mathbf{\dot{u}}_S, \mathbf{\ddot{u}}_S, \mathbf{x}) \triangleq
\mathbf{M}\mathbf{\ddot{u}}_S + \mathbf{C}\mathbf{\dot{u}}_S + \mathbf{K}\mathbf{u}_S
- \mathbf{f}_S = 0\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathbf{f}_S\)</span> - nodal forces on structure</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{u}_S\)</span> - displacements of structural nodes</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathbf{x}\)</span> - design variable vector</p></li>
</ul>
</section>
</section>
<section id="aeroelastic-framework">
<h2>Aeroelastic Framework<a class="headerlink" href="#aeroelastic-framework" title="Permalink to this heading">¶</a></h2>
<p>The forward solve path in FUNtoFEM goes through several steps.
First, the surface displacements are computed inside FUNtoFEM, taking the displacement
of structural nodes, <span class="math notranslate nohighlight">\(\mathbf{u}_S\)</span>, as an input and solving for the displacements of
aerodynamic surface nodes, <span class="math notranslate nohighlight">\(\mathbf{u}_A\)</span>, in the displacement
transfer residual, <span class="math notranslate nohighlight">\(\mathbf{\color{green}D}\)</span>.
The grid deformation residual, <span class="math notranslate nohighlight">\(\mathbf{\color{blue}G}\)</span>, is then
computed with the displacement of the aerodynamic surface nodes, <span class="math notranslate nohighlight">\(\mathbf{u}_A\)</span>,
as an input and solving for <span class="math notranslate nohighlight">\(\mathbf{x}_G\)</span>, the aerodynamic volume mesh.
This is then followed by the flow residual, <span class="math notranslate nohighlight">\(\mathbf{\color{blue}A}\)</span>,
and the force integration residual, <span class="math notranslate nohighlight">\(\mathbf{\color{blue}F}\)</span>.
These three residuals are internal to FUN3D.
The load transfer residual, <span class="math notranslate nohighlight">\(\mathbf{\color{green}L}\)</span>, is then solved inside FUNtoFEM.
Finally, the structural residual, <span class="math notranslate nohighlight">\(\mathbf{\color{orange}S}\)</span>, is computed in TACS.</p>
<p>The order of execution in the forward solve follows the list shown below.
The underlined value is solved for at each step.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\mathbf{\color{green}D}(\underline{\mathbf{u}_A}, \mathbf{u}_S) &amp;= 0 \\
\mathbf{\color{blue}G}(\mathbf{u}_A, \underline{\mathbf{x}_G}) &amp;= 0 \\
\mathbf{\color{blue}A}(\underline{\mathbf{q}}, \mathbf{x}_G) &amp;= 0 \\
\mathbf{\color{blue}F}(\underline{\mathbf{f}_A}, \mathbf{q}, \mathbf{x}_G) &amp;= 0 \\
\mathbf{\color{green}L}(\mathbf{f}_A, \underline{\mathbf{f}_S}, \mathbf{u}_S) &amp;= 0 \\
\mathbf{\color{orange}S}(\mathbf{f}_S, \underline{\mathbf{u}_S}) &amp;= 0
\end{align}\end{split}\]</div>
<section id="aeroelastic-adjoint">
<h3>Aeroelastic Adjoint<a class="headerlink" href="#aeroelastic-adjoint" title="Permalink to this heading">¶</a></h3>
<p>The order of execution in the code follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align}
\frac{\partial \mathbf{L}^T}{\partial \mathbf{f}_S} {\psi_L} + \frac{\partial \mathbf{S}^T}{\partial \mathbf{f}_S}\psi_S &amp;= 0 \\
\frac{\partial \mathbf{F}^T}{\partial \mathbf{f}_A}\psi_F + \frac{\partial \mathbf{L}^T}{\partial \mathbf{f}_A}\psi_L &amp;= 0 \\
\frac{\partial \mathbf{A}^T}{\partial \mathbf{q}}\psi_A + \frac{\partial \mathbf{F}^T}{\partial \mathbf{q}}\psi_F &amp;= -\frac{\partial \mathbf{f}^T}{\partial \mathbf{q}} \\
\frac{\partial \mathbf{G}^T}{\partial \mathbf{x}_G}\psi_G + \frac{\partial \mathbf{A}^T}{\partial \mathbf{x}_G}\psi_A + \frac{\partial \mathbf{F}^T}{\partial \mathbf{x}_G}\psi_F &amp;= -\frac{\partial \mathbf{f}^T}{\partial \mathbf{x}_G} \\
\frac{\partial \mathbf{D}^T}{\partial \mathbf{u}_A}\psi_D + \frac{\partial \mathbf{G}^T}{\partial \mathbf{u}_A}\psi_G &amp;= 0 \\
\frac{\partial \mathbf{S}^T}{\partial \mathbf{u}_S}\psi_S + \frac{\partial \mathbf{D}^T}{\partial \mathbf{u}_S}\psi_D +
\frac{\partial \mathbf{L}^T}{\partial \mathbf{u}_S}\psi_L &amp;= -\frac{\partial \mathbf{f}^T}{\partial \mathbf{u}_S} \\
\end{align}\end{split}\]</div>
<p>The corresponding Lagrangian in the aeroelastic framework is given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathcal{L}(\mathbf{x}, \mathbf{q}, \mathbf{x}_{G}, \mathbf{u}_{A}, \mathbf{f}_{A}, \mathbf{f}_{S}, \mathbf{u}_S) = &amp;
  f(\mathbf{x}, \mathbf{q}, \mathbf{x}_{G}, \mathbf{u}_{A}, \mathbf{f}_{A}, \mathbf{f}_{S}, \mathbf{u}_S)
   +\mathbf{\psi}_{G}^{T} {\mathbf{G}} (\mathbf{x}, \mathbf{u}_{A}, \mathbf{x}_{G} )         \\
  &amp;+\mathbf{\psi}_{A}^{T} {\mathbf{A}} (\mathbf{x}, \mathbf{q}, \mathbf{x}_{G})
   +\mathbf{\psi}_{F}^{T} {\mathbf{F}} (\mathbf{x}, \mathbf{x}_{G}, \mathbf{q}, \mathbf{f}_{A}) \\
  &amp;+\mathbf{\psi}_{L}^{T} {\mathbf{L}} (\mathbf{x}, \mathbf{u}_S, \mathbf{f}_{A}, \mathbf{f}_{S})
   +\mathbf{\psi}_{S}^{T} {\mathbf{S}} (\mathbf{x}, \mathbf{u}_S, \mathbf{f}_{S})             \\
  &amp;+\mathbf{\psi}_{D}^{T} {\mathbf{D}} (\mathbf{x}, \mathbf{u}_S, \mathbf{u}_{A})\end{split}\]</div>
</section>
</section>
<section id="aerothermal-framework">
<h2>Aerothermal Framework<a class="headerlink" href="#aerothermal-framework" title="Permalink to this heading">¶</a></h2>
<figure class="align-default">
<img alt="_images/aerothermal_framework.png" src="_images/aerothermal_framework.png" />
</figure>
<p>The residuals for the aerodynamic governing equations are obtained using a discrete approximation of the following integral over each finite volume</p>
<div class="math notranslate nohighlight">
\[{A}\left({x}, {q}, {\dot{q}}, {x}_G, {\dot{x}}_G, {t}_{A}, t\right) \triangleq \dfrac{\partial \left( V {q} \right)}
{\partial t} + \oint_{\partial V} \left( {\overline{\overline{F}}}^* - {\overline{\overline{F}}_v} \right) \cdot { \hat{n}} dS = 0\]</div>
<p>An interface has been added to FUN3D for aerothermoelastic analysis using the FUNtoFEM framework.
This interface provides routines for both force and heat flux integration, as well as the terms needed for the adjoint equations.
Furthermore, the interface adds the required multidisciplinary components to the right-hand-side of the aerodynamic adjoint equations.
The force integration is a function of the aerodynamic state variables and the node locations and constitutes a system of residuals written as:</p>
<div class="math notranslate nohighlight">
\[{F} \left( {x}, {x}_G, {q}, {f}_A \right) \triangleq {\phi} \left( {x}, {x}_G, {q} \right) - {f}_A = 0\]</div>
<p>The heat flux integration is also a function of the aerodynamic state variables and node locations and is written as</p>
<div class="math notranslate nohighlight">
\[{H} \left( {x}, {x}_G, {q}, {f}_{T,A} \right) \triangleq {\varphi} \left( {x}, {x}_G, {q} \right) - {f}_{T,A} = 0\]</div>
<section id="aerothermal-adjoint">
<h3>Aerothermal Adjoint<a class="headerlink" href="#aerothermal-adjoint" title="Permalink to this heading">¶</a></h3>
<p>The Lagrangian for the aerothermal problem is formed by summing the function of interest with the products of the
residuals for each analysis component combined with their corresponding adjoint, giving the following expression:</p>
<div class="math notranslate nohighlight">
\[\begin{split}    \mathbf{\mathcal{L}}_{AT} \triangleq \; &amp; f(\mathbf{x},\mathbf{q},\mathbf{t}_{A},\mathbf{f}_{T,A},\mathbf{f}_{T,S},\mathbf{t}_{S})
+ \mathbf{\psi}_{A}^{T} \mathbf{A}(\mathbf{x},\mathbf{q},{t}_{A})
+ \mathbf{\psi}_{H}^{T} \mathbf{H}(\mathbf{x},\mathbf{t}_{A},\mathbf{q},\mathbf{f}_{T,A})
+ \mathbf{\psi}_{Q}^{T} \mathbf{Q}(\mathbf{f}_{T,A},\mathbf{f}_{T,S})\\
&amp; + \mathbf{\psi}_{T,S}^{T} \mathbf{S}(\mathbf{x},\mathbf{t}_{S},\mathbf{f}_{T,S})
+ \mathbf{\psi}_{T}^{T} \mathbf{T}(\mathbf{t}_{S},{t}_{A})\end{split}\]</div>
<p>The adjoint equations are obtained by taking the derivative of the Lagrangian with respect to the state variables and
setting it to zero. This results in the following coupled system of equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
\frac{\partial \mathbf{A}}{\partial \mathbf{q}}^{T} &amp;
\frac{\partial \mathbf{H}}{\partial \mathbf{q}}^{T} &amp; 0 &amp; 0 &amp; 0\\
%
0 &amp; \frac{\partial \mathbf{H}}{\partial \mathbf{f}_{T,A}}^{T} &amp;
\frac{\partial \mathbf{Q}}{\partial \mathbf{f}_{T,A}}^{T} &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; \frac{\partial \mathbf{Q}}{\partial \mathbf{f}_{T,S}}^{T} &amp;
\frac{\partial \mathbf{S}}{\partial \mathbf{f}_{T,S}}^{T} &amp; 0 \\
%
0 &amp; 0 &amp; 0 &amp; \frac{\partial \mathbf{S}}{\partial \mathbf{t}_{S}}^{T} &amp;
\frac{\partial \mathbf{T}}{\partial \mathbf{t}_{S}}^{T} \\
%
\frac{\partial \mathbf{A}}{\partial \mathbf{t}_{A}}^{T} &amp; 0 &amp; 0 &amp; 0 &amp;
\frac{\partial \mathbf{T}}{\partial \mathbf{t}_{A}}^{T} \\
%
\end{bmatrix}
\begin{bmatrix}
\mathbf{\psi}_{A} \\
\mathbf{\psi}_{H} \\
\mathbf{\psi}_{Q} \\
\mathbf{\psi}_{T,S} \\
\mathbf{\psi}_{T}
\end{bmatrix}
= -
\begin{bmatrix}
\frac{\partial f}{\partial \mathbf{q}}^{T} \\
\frac{\partial f}{\partial \mathbf{f}_{T,A}}^{T} \\
\frac{\partial f}{\partial \mathbf{f}_{T,S}}^{T} \\
\frac{\partial f}{\partial \mathbf{t}_{S}}^{T} \\
\frac{\partial f}{\partial \mathbf{t}_{A}}^{T} \\
\end{bmatrix}\end{split}\]</div>
</section>
</section>
<section id="aerothermoelastic-framework">
<h2>Aerothermoelastic Framework<a class="headerlink" href="#aerothermoelastic-framework" title="Permalink to this heading">¶</a></h2>
<figure class="align-default">
<img alt="_images/atePath.svg" src="_images/atePath.svg" /></figure>
<p>The surface displacements are computed by solving the displacement transfer residuals and preserving rigid-body motion. The displacement transfer scheme is given by:</p>
<div class="math notranslate nohighlight">
\[{D}({x}, {u}_{S}, {u}_{A}) \triangleq {\xi}({x}, {u}_{S}) - {u}_{A} = 0\]</div>
<p>To obtain a consistent and conservative load transfer, the load transfer is derived based on the method of virtual work. The residual of the load transfer scheme is:</p>
<div class="math notranslate nohighlight">
\[{L}({x}, {u}_{S}, {f}_{A}, {f}_{S}) \triangleq {\eta}({x}, {u}_{S}, {f}_{A}) - {f}_{S} = 0\]</div>
<p>MELDThermal links each aerodynamic surface node, where a wall temperature will be specified, to a fixed number of the nearest
structural nodes from which the structural temperature will be interpolated.
This approach is analogous to the localization property of MELD such that each aerodynamic surface node receives temperature
information from a limited number of structural nodes. The temperature of the aerodynamic surface node is then computed from the
temperatures of the set of linked structural nodes:</p>
<div class="math notranslate nohighlight">
\[T_{A} = \sum_{i=1}^{N} w_{i} {T_{S}}_{i}\]</div>
<p>The weights are computed based on the Euclidean distance between the aerodynamic node and the corresponding structural surface nodes:</p>
<div class="math notranslate nohighlight">
\[w_{i} = e^{- \beta d_{i}^2}  \Bigg/ \sum_{j=1}^{N} e^{- \beta d_{j}^2}\]</div>
<p>The interpolation is repeated for all aerodynamic surface nodes, giving the temperature transfer residual:</p>
<div class="math notranslate nohighlight">
\[{T}({t}_{S}, {t}_{A}) \triangleq  {W} {t}_{S} - {t}_{A} = 0,\]</div>
<p>Because FUN3D is a nondimensional code and heat flux does not scale linearly with a reference temperature, area-weighted
temperature gradients at the wall are extracted from FUN3D. Inside FUNtoFEM, the thermal conductivity is then calculated
at each aerodynamic surface node based on the corresponding aerodynamic temperatures. The area-weighted heat flux at the
aerodynamic surface nodes is then calculated as a product of the temperature gradients and thermal conductivity values.
The relationship between the area-weighted heat flux at the aerodynamic surface nodes and the resulting heat flux on the
structural nodes is calculated in the same manner as the loads. Based on virtual work, the flux produced at a structural
node by the force at an aerodynamic surface node is:</p>
<div class="math notranslate nohighlight">
\[{Q}({f}_{T,A}, {f}_{T,S}) \triangleq {W}^{T} {f}_{T,A} - {f}_{T,S} = 0\]</div>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Body Class Members</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Variable Name</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Role</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u_A\)</span></p></td>
<td><p>aero_disps</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> aero_nnodes</p></td>
<td><p>FUN3D input</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(t_A\)</span></p></td>
<td><p>aero_temps</p></td>
<td><p>aero_nnodes</p></td>
<td><p>FUN3D input</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(f_A\)</span></p></td>
<td><p>aero_loads</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> aero_nnodes</p></td>
<td><p>FUN3D output</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h_A\)</span></p></td>
<td><p>aero_flux</p></td>
<td><p>aero_nnodes</p></td>
<td><p>FUN3D output</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(f_S\)</span></p></td>
<td><p>struct_loads</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> struct_nnodes</p></td>
<td><p>TACS input</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(h_S\)</span></p></td>
<td><p>struct_flux</p></td>
<td><p>struct_nnodes</p></td>
<td><p>TACS input</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u_S\)</span></p></td>
<td><p>struct_disps</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> struct_nnodes</p></td>
<td><p>TACS output</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(t_S\)</span></p></td>
<td><p>struct_temps</p></td>
<td><p>struct_nnodes</p></td>
<td><p>TACS output</p></td>
</tr>
</tbody>
</table>
<p>The body class members listed above use accessors to get them. aero_nnodes refers to the number
of nodes on the aerodynamic surface mesh. Similarly, struct_nnodes refers to the number of nodes
on the structural mesh. Where the size is indicated as 3 <span class="math notranslate nohighlight">\(\times\)</span> nnodes, the vector is structured as concatenated
trios of (x, y, z) values.</p>
<section id="aerothermoelastic-adjoint">
<h3>Aerothermoelastic Adjoint<a class="headerlink" href="#aerothermoelastic-adjoint" title="Permalink to this heading">¶</a></h3>
<p>The aerothermoelastic adjoint equations are derived to be discretely consistent with the forward governing equations.
The Lagrangian for the aerothermoelastic problem is formed by summing the function of interest with the products of the residuals
for each analysis component combined with their corresponding adjoint, giving the following expression:</p>
<div class="math notranslate nohighlight">
\[\begin{split}    \mathbf{\mathcal{L}}_{ATE} \triangleq \; &amp; f({x}, {q}, {x}_{G}, {f}_{A}, {f}_{S}, h_A, h_S, {u}_{S}, {t}_{S}, {u}_{A}, {t}_{A})
+ \psi_{A}^{T} \mathbf{A}({x}, {q}, {x}_G, {t}_{A} )
+ \psi_{G}^{T} \mathbf{G}\left({x}, {u}_{A}, {x}_G\right) \\
&amp; + \psi_{F}^{T} \mathbf{F} ( {x}, {x}_G, {q}, {f}_A )
+ \psi_{L}^{T} \mathbf{L}({x}, {u}_{S}, {f}_{A}, {f}_{S})
+ \psi_{H}^{T} \mathbf{H} \left( {x}, {x}_G, {q}, h_A \right)
+ \psi_{Q}^{T} \mathbf{Q}(h_A,h_S) \\
&amp; + \psi_{S}^{T} \mathbf{S}(x,u_S,t_S,f_S,h_S)
+ \psi_{D}^{T} \mathbf{D}(x, u_S, u_A)
+ \psi_{T}^{T} \mathbf{T}(t_S,t_A)\end{split}\]</div>
<p>The adjoint equations are obtained by taking the derivative of the aerothermoelastic Lagrangian with respect to the state
variables and setting it to zero. This results in the following coupled system of equations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{bmatrix}
\frac{\partial A}{\partial q}^{T} &amp; 0 &amp;
\frac{\partial {F}}{\partial {q}}^{T} &amp; 0 &amp;
\frac{\partial H}{\partial q}^{T} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
%
\frac{\partial {A}}{\partial {x}_{G}}^{T} &amp;
\frac{\partial {G}}{\partial {x}_{G}}^{T} &amp;
\frac{\partial {F}}{\partial {x}_{G}}^{T} &amp; 0 &amp;
\frac{\partial {H}}{\partial {x}_{G}}^{T} &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; \frac{\partial {F}}{\partial {f}_{A}}^{T} &amp;
\frac{\partial {L}}{\partial {f}_{A}}^{T} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; 0 &amp; \frac{\partial {L}}{\partial {f}_{S}}^{T} &amp;
0 &amp; 0 &amp; \frac{\partial {S}}{\partial {f}_{S}}^{T} &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\partial {H}}{\partial h_A}^{T} &amp;
\frac{\partial {Q}}{\partial h_A}^{T} &amp; 0 &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\partial {Q}}{\partial h_S}^{T} &amp;
\frac{\partial S}{\partial h_S}^{T} &amp; 0 &amp; 0 \\
%
0 &amp; 0 &amp; 0 &amp; \frac{\partial L}{\partial u_S}^T &amp; 0 &amp; 0 &amp;
\frac{\partial {S}}{\partial {u}_{S}}^{T} &amp;
\frac{\partial {D}}{\partial {u}_{S}}^{T} &amp;
0 \\
%
0 &amp; \frac{\partial {G}}{\partial {u}_{A}}^{T} &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp;
\frac{\partial {D}}{\partial {u}_{A}}^{T} &amp; 0 \\
%
\frac{\partial {A}}{\partial {t}_{A}}^{T} &amp; 0 &amp; 0 &amp; 0 &amp; \frac{\partial H}{\partial t_A}^T &amp; 0 &amp; 0 &amp; 0 &amp;
\frac{\partial {T}}{\partial {t}_{A}}^{T}
\end{bmatrix}
\begin{bmatrix}
\psi_{A} \\
\psi_{G} \\
\psi_{F} \\
\psi_{L} \\
\psi_{H} \\
\psi_{Q} \\
\psi_{S} \\
\psi_{D} \\
\psi_{T} \\
\end{bmatrix}
= -
\begin{bmatrix}
\frac{\partial f}{\partial q}^{T} \\
\frac{\partial f}{\partial x_{G}}^{T} \\
\frac{\partial f}{\partial f_{A}}^{T} \\
\frac{\partial f}{\partial f_{S}}^{T} \\
\frac{\partial f}{\partial h_A}^{T} \\
\frac{\partial f}{\partial h_S}^{T} \\
\frac{\partial f}{\partial u} \\
\frac{\partial f}{\partial u_{A}} \\
\frac{\partial f}{\partial t_{A}}
\end{bmatrix}\end{split}\]</div>
<p>Once the solution for the adjoint equations has been obtained, the total derivative for the function of
interest is computed as the derivative of the Lagrangian.</p>
<div class="math notranslate nohighlight">
\[\nabla_{{x}}f \triangleq \frac{\partial \mathcal{L}_{ATE}}{\partial {x}}\]</div>
<p>The abbreviation “AJP” is used for the “Adjoint-Jacobian Product.” The names of the AJP variables correspond to the
off-diagonal terms of the partial derivative of the Lagrangian with respect to the variable in the forward path with the same name.
The number of functions is abbreviated as nfuncs for a given scenario.</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Adjoint-Jacobian Products</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Expression</p></th>
<th class="head"><p>Variable Name</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Role</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\psi_G^T \frac{\partial G}{\partial u_A}\)</span></p></td>
<td><p>aero_disps_ajp</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> aero_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>FUN3D output</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\psi_A^T \frac{\partial A}{\partial t_A} + \psi_H^T \frac{\partial H}{\partial t_A}\)</span></p></td>
<td><p>aero_temps_ajp</p></td>
<td><p>aero_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>FUN3D output</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\psi_L^T \frac{\partial L}{\partial f_A}\)</span></p></td>
<td><p>aero_loads_ajp</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> aero_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>FUN3D input</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\psi_Q^T \frac{\partial Q}{\partial h_A}\)</span></p></td>
<td><p>aero_flux_ajp</p></td>
<td><p>aero_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>FUN3D input</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\psi_S^T \frac{\partial S}{\partial f_S}\)</span></p></td>
<td><p>struct_loads_ajp</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> struct_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>TACS output</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\psi_S^T \frac{\partial S}{\partial h_S}\)</span></p></td>
<td><p>struct_flux_ajp</p></td>
<td><p>struct_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>TACS output</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\psi_D^T \frac{\partial D}{\partial u_S} + \psi_L^T \frac{\partial L}{\partial u_S}\)</span></p></td>
<td><p>struct_disps_ajp</p></td>
<td><p>3 <span class="math notranslate nohighlight">\(\times\)</span> struct_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>TACS input</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\psi_T^T \frac{\partial T}{\partial t_S}\)</span></p></td>
<td><p>struct_temps_ajp</p></td>
<td><p>struct_nnodes <span class="math notranslate nohighlight">\(\times\)</span> nfuncs</p></td>
<td><p>TACS input</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Analysis Framework</a><ul>
<li><a class="reference internal" href="#meld-transfer-scheme">MELD Transfer Scheme</a><ul>
<li><a class="reference internal" href="#displacement-transfer-residual">Displacement Transfer Residual</a></li>
<li><a class="reference internal" href="#load-transfer-residual">Load Transfer Residual</a></li>
<li><a class="reference internal" href="#heat-flux-transfer-residual">Heat Flux Transfer Residual</a></li>
<li><a class="reference internal" href="#temperature-residual">Temperature Residual</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fun3d-flow-solver">FUN3D, Flow Solver</a><ul>
<li><a class="reference internal" href="#flow-residual">Flow Residual</a></li>
<li><a class="reference internal" href="#force-integration-residual">Force Integration Residual</a></li>
<li><a class="reference internal" href="#grid-deformation-residual">Grid Deformation Residual</a></li>
<li><a class="reference internal" href="#heat-flux-integration-residual">Heat Flux Integration Residual</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tacs-structure-solver">TACS, Structure Solver</a><ul>
<li><a class="reference internal" href="#structural-residual">Structural Residual</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aeroelastic-framework">Aeroelastic Framework</a><ul>
<li><a class="reference internal" href="#aeroelastic-adjoint">Aeroelastic Adjoint</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aerothermal-framework">Aerothermal Framework</a><ul>
<li><a class="reference internal" href="#aerothermal-adjoint">Aerothermal Adjoint</a></li>
</ul>
</li>
<li><a class="reference internal" href="#aerothermoelastic-framework">Aerothermoelastic Framework</a><ul>
<li><a class="reference internal" href="#aerothermoelastic-adjoint">Aerothermoelastic Adjoint</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Welcome to FUNtoFEM’s Documentation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="model.html"
                          title="next chapter">FUNtoFEM Model</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="model.html" title="FUNtoFEM Model"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to FUNtoFEM’s Documentation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">FUNtoFEM .0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Analysis Framework</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, FUNtoFEM Developers.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>